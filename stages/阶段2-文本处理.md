# Linux命令学习大纲 - 阶段2：文本处理

## 🎯 阶段目标
掌握文本搜索、编辑和处理技能，能够高效处理文件内容。

## 📋 学习内容

### 2.0 文本输出和显示

#### `echo` - 文本输出命令
**核心概念：** 在终端显示文本或变量值，是最基础的输出命令

**基本用法：** `echo [选项] [字符串]`

**常用选项：**
- `echo -n`：输出后不换行
- `echo -e`：启用转义字符（如 `\n` 换行，`\t` 制表符）
- `echo -E`：禁用转义字符（默认行为）

**核心功能：**
1. **显示文本**：直接输出字符串
2. **显示变量**：输出变量的值
3. **命令替换**：显示命令执行结果
4. **文件重定向**：将输出写入文件

**示例详解：**

**基本文本输出：**
```bash
echo "Hello World"           # 输出：Hello World
echo Hello World             # 输出：Hello World（引号可省略）
echo 'Hello World'           # 输出：Hello World（单引号）
```

**变量输出：**
```bash
name="Alice"
echo "My name is $name"      # 输出：My name is Alice
echo 'My name is $name'      # 输出：My name is $name（单引号不解析变量）
echo "Today is $(date)"      # 输出：Today is Wed Nov 27 12:34:56 2025
```

**转义字符控制：**
```bash
echo -n "No newline"         # 输出后不换行
echo "Next line"             # 会接在上一行后面

echo -e "Line 1\nLine 2"       # 输出两行：
                              # Line 1
                              # Line 2

echo -e "Tab\tseparated"     # 输出：Tab    separated
echo -e "\aBell sound"       # 发出蜂鸣声
```

**与重定向结合：**
```bash
echo "Hello" > file.txt      # 创建/覆盖文件，写入"Hello"
echo "World" >> file.txt     # 追加写入"World"

# 创建多行文件
echo -e "Line 1\nLine 2\nLine 3" > multiline.txt

# 生成配置文件
echo "# Configuration file" > config.ini
echo "name=app" >> config.ini
echo "version=1.0" >> config.ini
```

**高级用法：**
```bash
# 显示命令执行结果
echo "Current directory: $(pwd)"
echo "Files count: $(ls | wc -l)"

# 显示系统信息
echo "User: $(whoami)"
echo "Home: $HOME"
echo "Path: $PATH"

# 格式化输出
echo -e "\n=== System Info ==="
echo "Hostname: $(hostname)"
echo "Uptime: $(uptime -p)"
echo "Memory: $(free -h | grep Mem | awk '{print $3 "/" $2}')"
```

**实际应用场景：**
1. **脚本调试**：输出变量值检查状态
2. **状态显示**：显示脚本执行进度
3. **文件生成**：快速创建配置文件
4. **日志记录**：记录脚本运行信息

**注意事项：**
- 变量在双引号中会被解析，在单引号中保持字面含义
- `-e` 选项启用转义，`-E` 禁用转义（默认）
- 与重定向结合使用时，`>` 覆盖文件，`>>` 追加内容
- 在脚本中使用时，常用于输出状态信息或调试信息

### 2.1 文本搜索

#### `grep` (global regular expression print) - 文本搜索
**核心概念：** 模式匹配搜索
- 基本用法：`grep 模式 文件`
- 常用选项：
  - `grep -i`：忽略大小写
  - `grep -n`：显示行号
  - `grep -v`：反向匹配（显示不匹配的行）
  - `grep -r`：递归搜索目录
  - `grep -l`：只显示匹配的文件名
  - `grep -c`：统计匹配行数
- 示例：
  ```bash
  grep "error" log.txt           # 搜索包含"error"的行
  grep -n "Error" *.log          # 显示行号
  grep -r "TODO" .               # 递归搜索所有文件
  grep -i "warning" syslog       # 忽略大小写搜索
  grep -v "^#" config.txt        # 显示不以#开头的行
  ```

#### `find` - 文件查找
**核心概念：** 高级文件搜索
- 基本用法：`find 路径 条件`
- 常用条件：
  - `-name "模式"`：按文件名查找
  - `-type f/d`：文件类型（f=文件，d=目录）
  - `-size +10M`：文件大小
  - `-mtime -7`：修改时间（天）
  - `-exec 命令 {} \;`：对找到的文件执行命令
- 示例：
  ```bash
  find . -name "*.txt"           # 查找所有txt文件
  find /home -type d -name "doc*" # 查找以doc开头的目录
  find . -size +1M               # 查找大于1MB的文件
  find . -mtime -7               # 查找7天内修改的文件
  find . -name "*.log" -exec rm {} \;  # 删除所有log文件
  ```

### 2.2 文本编辑和处理

#### `sed` (stream editor) - 流编辑器
**核心概念：** 文本替换和编辑
- 基本语法：`sed '操作' 文件`
- 常用操作：
  - `s/old/new/g`：全局替换
  - `d`：删除行
  - `p`：打印行
  - `a\text`：在匹配行后追加文本
  - `i\text`：在匹配行前插入文本
- 示例：
  ```bash
  sed 's/error/warning/g' file.txt     # 替换所有error为warning
  sed '/^#/d' config.txt               # 删除注释行
  sed 's/$/\r/' file.txt               # 在每行末尾添加回车符
  sed '1,10d' file.txt                 # 删除前10行
  ```

#### `awk` - 文本处理和报告生成器
**核心概念：** 列处理和数据提取
- 基本语法：`awk '模式 {动作}' 文件`
- 内置变量：
  - `$0`：整行内容
  - `$1,$2,...`：各列内容
  - `NR`：当前行号
  - `NF`：列数
- 示例：
  ```bash
  awk '{print $1}' file.txt            # 打印第一列
  awk '{print NR ": " $0}' file.txt    # 添加行号
  awk '$3 > 100 {print $1}' data.txt   # 打印第三列大于100的行的第一列
  awk '{sum += $1} END {print sum}' numbers.txt  # 计算总和
  ```

#### `sort` - 文本排序
**核心概念：** 数据排序
- 基本用法：`sort 文件`
- 常用选项：
  - `sort -n`：数值排序
  - `sort -r`：反向排序
  - `sort -k 2`：按第2列排序
  - `sort -u`：去重
- 示例：
  ```bash
  sort names.txt                       # 字母排序
  sort -n numbers.txt                  # 数值排序
  sort -k 3 -n data.txt                # 按第3列数值排序
  sort -r -k 2 file.txt                # 按第2列反向排序
  ```

#### `uniq` - 去除重复行
**核心概念：** 数据去重
- 基本用法：`uniq 文件`
- 常用选项：
  - `uniq -c`：统计重复次数
  - `uniq -d`：只显示重复行
  - `uniq -u`：只显示不重复行
- 注意：`uniq`通常需要先排序
- 示例：
  ```bash
  sort names.txt | uniq                 # 去重
  sort names.txt | uniq -c              # 统计每个名字出现次数
  sort data.txt | uniq -d               # 显示重复的行
  ```

#### `wc` (word count) - 统计计数
**核心概念：** 文件统计
- 基本用法：`wc 文件`
- 输出说明：
  - 第一列：行数
  - 第二列：单词数
  - 第三列：字节数
- 常用选项：
  - `wc -l`：只统计行数
  - `wc -w`：只统计单词数
  - `wc -c`：只统计字节数
- 示例：
  ```bash
  wc file.txt                          # 显示完整统计
  wc -l *.txt                          # 统计所有txt文件的行数
  cat file.txt | wc -w                 # 统计单词数
  ```

## 🏋️ 练习任务

### 基础练习

1. **grep搜索练习**
   ```bash
   # 创建测试文件
   echo "This is a test file" > test.txt
   echo "Error: something went wrong" >> test.txt
   echo "Warning: check this out" >> test.txt
   echo "Info: everything is fine" >> test.txt

   # 搜索练习
   grep "Error" test.txt
   grep -i "warning" test.txt
   grep -n "is" test.txt
   grep -v "Error" test.txt
   ```

2. **find查找练习**
   ```bash
   # 在项目目录中查找文件
   cd linux-practice
   find . -name "*.txt"
   find . -type f -name "*note*"
   find . -mtime -1  # 查找今天修改的文件
   ```

3. **sort和uniq练习**
   ```bash
   # 创建测试数据
   echo -e "apple\nbanana\ncherry\napple\nbanana" > fruits.txt

   # 排序和去重
   sort fruits.txt
   sort fruits.txt | uniq
   sort fruits.txt | uniq -c
   ```

### 综合练习

1. **日志分析练习**
   ```bash
   # 创建模拟日志文件
   cat > access.log << 'EOF'
   192.168.1.1 - - [10/Oct/2023:13:55:36] "GET /index.html" 200 1024
   192.168.1.2 - - [10/Oct/2023:13:56:12] "GET /about.html" 200 512
   192.168.1.1 - - [10/Oct/2023:13:57:45] "GET /contact.html" 404 256
   192.168.1.3 - - [10/Oct/2023:13:58:23] "GET /index.html" 200 1024
   EOF

   # 日志分析
   grep "404" access.log                    # 查找错误请求
   awk '{print $1}' access.log | sort | uniq -c  # 统计IP访问次数
   grep "GET" access.log | wc -l            # 统计GET请求数
   ```

2. **文本处理管道练习**
   ```bash
   # 创建测试数据
   cat > data.txt << 'EOF'
   Name: John, Age: 25, City: New York
   Name: Jane, Age: 30, City: London
   Name: Bob, Age: 35, City: Paris
   Name: Alice, Age: 28, City: Tokyo
   EOF

   # 综合处理
   cat data.txt | grep "Name:" | sed 's/Name: //' | sort
   awk -F', ' '{print $2}' data.txt | sort -n
   cat data.txt | wc -l
   ```

3. **配置文件处理练习**
   ```bash
   # 创建配置文件
   cat > config.ini << 'EOF'
   # Database settings
   db_host=localhost
   db_port=5432
   # Cache settings
   cache_enabled=true
   cache_size=1024
   # Debug mode
   debug=false
   EOF

   # 配置文件处理
   grep -v "^#" config.ini                 # 移除注释
   grep "=" config.ini | wc -l             # 统计配置项数量
   sed 's/=.*//' config.ini                # 提取配置项名称
   ```

## 📚 学习要点

1. **正则表达式基础**：`grep`支持正则表达式
   - `^`：行首
   - `$`：行尾
   - `*`：零个或多个
   - `+`：一个或多个
   - `.`：任意字符

2. **管道操作**：命令组合使用
   ```bash
   command1 | command2 | command3
   ```

3. **重定向**：输入输出控制
   - `>`：输出重定向（覆盖）
   - `>>`：输出重定向（追加）
   - `<`：输入重定向
   - `2>`：错误输出重定向

4. **文本处理思维**：将复杂任务分解为简单步骤

## 🎯 阶段检查清单

- [ ] 熟练使用`grep`进行各种搜索
- [ ] 掌握`find`的高级查找功能
- [ ] 能使用`sed`进行基本文本替换
- [ ] 理解`awk`的列处理概念
- [ ] 掌握排序和去重操作
- [ ] 能进行基本的日志分析

## 🔄 下一步预览

完成本阶段后，你将进入**阶段3：系统管理**，学习进程管理、权限控制和系统监控，这将让你成为真正的Linux系统管理员。

---

## 💡 学习提示

- **组合命令**：尝试将多个命令用管道连接使用
- **练习数据**：创建各种格式的测试数据来练习
- **观察结果**：注意每个命令的输出格式和内容
- **构建思维**：学会将复杂任务分解为简单步骤
