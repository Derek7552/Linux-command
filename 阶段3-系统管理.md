# Linux命令学习大纲 - 阶段3：系统管理

## 🎯 阶段目标
掌握Linux系统的基本管理技能，包括进程管理、权限控制、系统监控和软件包管理。

## 📋 学习内容

### 3.1 进程管理

#### `ps` (process status) - 显示进程信息
**核心概念：** 进程状态查看
- 基本用法：`ps`
- 常用选项：
  - `ps aux`：显示所有进程详细信息
  - `ps -ef`：显示完整格式的进程信息
- 输出字段：
  - `USER`：进程所有者
  - `PID`：进程ID
  - `%CPU`：CPU使用率
  - `%MEM`：内存使用率
  - `VSZ`：虚拟内存大小
  - `RSS`：实际内存使用
  - `TTY`：终端
  - `STAT`：进程状态
  - `START`：启动时间
  - `TIME`：累计CPU时间
  - `COMMAND`：命令行
- 示例：
  ```bash
  ps aux | head -10                   # 查看前10个进程
  ps -ef | grep nginx                 # 查找nginx进程
  ps aux --sort=-%cpu | head -5       # 按CPU使用率排序
  ```

#### `top` 和 `htop` - 实时进程监控
**核心概念：** 动态系统监控
- `top` 基本用法：
  - `top`：启动监控
  - `q`：退出
  - `k`：杀死进程
  - `r`：重新设置进程优先级
  - `s`：改变刷新间隔
- 常用交互命令：
  - `Shift+P`：按CPU使用率排序
  - `Shift+M`：按内存使用率排序
  - `u`：显示特定用户的进程
- `htop`：更友好的交互式进程查看器

#### `kill` - 终止进程
**核心概念：** 进程终止
- 基本用法：`kill PID`
- 常用信号：
  - `SIGTERM (15)`：正常终止（默认）
  - `SIGKILL (9)`：强制终止
  - `SIGHUP (1)`：重新加载配置
  - `SIGINT (2)`：中断（Ctrl+C）
- 示例：
  ```bash
  kill 1234                          # 正常终止进程1234
  kill -9 1234                       # 强制终止进程1234
  kill -HUP $(pgrep nginx)           # 重启nginx进程
  ```

#### `bg`、`fg` 和 `jobs` - 作业控制
**核心概念：** 后台任务管理
- 基本用法：
  - `Ctrl+Z`：暂停当前任务
  - `bg`：将暂停的任务放到后台运行
  - `fg`：将后台任务调到前台
  - `jobs`：显示后台任务列表
- 示例：
  ```bash
  sleep 100                          # 运行长时间任务
  # 按Ctrl+Z暂停
  bg                                 # 放到后台运行
  jobs                              # 查看后台任务
  fg %1                             # 将任务1调到前台
  ```

### 3.2 系统资源监控

#### `df` (disk free) - 磁盘使用情况
**核心概念：** 存储空间监控
- 基本用法：`df`
- 常用选项：
  - `df -h`：人性化显示大小
  - `df -i`：显示inode使用情况
- 输出字段：
  - `Filesystem`：文件系统
  - `Size`：总大小
  - `Used`：已使用
  - `Avail`：可用空间
  - `Use%`：使用百分比
  - `Mounted on`：挂载点

#### `du` (disk usage) - 目录磁盘使用情况
**核心概念：** 目录大小分析
- 基本用法：`du 目录`
- 常用选项：
  - `du -sh`：显示总大小
  - `du -h`：人性化显示
  - `du --max-depth=1`：限制显示深度
- 示例：
  ```bash
  du -sh *                          # 显示当前目录下各项目的总大小
  du -h --max-depth=1 /home         # 显示home目录下一级的大小
  du -ah | sort -hr | head -10      # 显示最大的10个文件/目录
  ```

#### `free` - 内存使用情况
**核心概念：** 内存监控
- 基本用法：`free`
- 常用选项：
  - `free -h`：人性化显示
  - `free -s 2`：每2秒更新一次
- 内存类型：
  - `total`：总内存
  - `used`：已使用内存
  - `free`：空闲内存
  - `shared`：共享内存
  - `buff/cache`：缓冲区/缓存
  - `available`：可用内存

#### `uptime` - 系统运行时间和负载
**核心概念：** 系统负载监控
- 显示内容：
  - 当前时间
  - 系统运行时间
  - 登录用户数
  - 系统负载（1分钟、5分钟、15分钟平均值）

#### `who` 和 `w` - 用户登录信息
**核心概念：** 用户活动监控
- `who`：显示当前登录用户
- `w`：显示详细的用户活动信息
  - 用户名
  - 终端
  - 登录时间
  - 空闲时间
  - CPU使用
  - 当前运行的命令

### 3.3 权限管理

#### `chmod` (change mode) - 修改文件权限
**核心概念：** 文件权限控制
- 两种方式：
  1. **数字方式**：`chmod 755 file`
     - `r=4, w=2, x=1`
     - `7=rwx, 6=rw-, 5=r-x, 4=r--, 0=---`
  2. **符号方式**：`chmod u+x file`
     - `u`：所有者，`g`：组，`o`：其他，`a`：全部
     - `+`：添加权限，`-`：移除权限，`=`：设置权限
- 示例：
  ```bash
  chmod 755 script.sh               # rwxr-xr-x
  chmod u+x file.txt                # 给所有者添加执行权
  chmod g-w file.txt                # 移除组的写权限
  chmod a=r file.txt                # 所有人只读
  ```

#### `chown` (change owner) - 修改文件所有者
**核心概念：** 文件所有权管理
- 基本用法：`chown 用户名 文件`
- 常用选项：
  - `chown -R`：递归修改
- 示例：
  ```bash
  chown john file.txt               # 改变所有者为john
  chown :developers file.txt        # 改变所属组为developers
  chown john:developers file.txt    # 同时改变所有者和组
  chown -R john /home/project       # 递归改变目录所有者
  ```

#### `chgrp` (change group) - 修改文件所属组
**核心概念：** 组权限管理
- 基本用法：`chgrp 组名 文件`
- 示例：
  ```bash
  chgrp developers project/
  chgrp -R admin /var/log
  ```

#### `sudo` - 以超级用户权限执行命令
**核心概念：** 权限提升
- 基本用法：`sudo 命令`
- 常用选项：
  - `sudo -i`：切换到root用户
  - `sudo -u username`：以指定用户身份执行
- 示例：
  ```bash
  sudo apt update                   # 以root权限更新包列表
  sudo systemctl start nginx        # 启动nginx服务
  sudo -i                           # 切换到root shell
  ```

#### `su` - 切换用户
**核心概念：** 用户切换
- 基本用法：`su 用户名`
- 示例：
  ```bash
  su john                           # 切换到john用户
  su -                              # 切换到root（需要密码）
  su - john                         # 切换到john并加载其环境
  ```

#### `passwd` - 修改密码
**核心概念：** 密码管理
- 基本用法：`passwd`
- 常用选项：
  - `passwd 用户名`：修改指定用户的密码（需要root权限）
- 示例：
  ```bash
  passwd                           # 修改当前用户密码
  sudo passwd john                 # 修改john的密码
  ```

### 3.4 包管理和软件安装

#### 包管理器概述
**核心概念：** 软件包管理
Linux发行版通常使用不同的包管理器：

#### Debian/Ubuntu：`apt`
- 常用命令：
  - `apt update`：更新包列表
  - `apt upgrade`：升级所有包
  - `apt install 包名`：安装软件
  - `apt remove 包名`：卸载软件
  - `apt search 关键词`：搜索包
  - `apt show 包名`：显示包信息
  - `apt list --installed`：列出已安装的包
- 示例：
  ```bash
  sudo apt update
  sudo apt install vim
  apt search text-editor
  apt show vim
  ```

#### RedHat/CentOS：`yum` 或 `dnf`
- 常用命令：
  - `yum install 包名`：安装软件
  - `yum remove 包名`：卸载软件
  - `yum search 关键词`：搜索包
  - `yum info 包名`：显示包信息
  - `yum update`：更新系统

#### Arch Linux：`pacman`
- 常用命令：
  - `pacman -S 包名`：安装软件
  - `pacman -R 包名`：卸载软件
  - `pacman -Ss 关键词`：搜索包
  - `pacman -Si 包名`：显示包信息

## 🏋️ 练习任务

### 基础练习

1. **进程监控练习**
   ```bash
   # 查看系统进程
   ps aux | head -10
   ps -ef | grep ssh

   # 使用top监控系统
   top    # 观察CPU和内存使用，按q退出

   # 后台任务练习
   sleep 30 &
   jobs
   bg %1
   fg %1
   ```

2. **系统资源监控练习**
   ```bash
   # 查看磁盘使用
   df -h
   du -sh *

   # 查看内存使用
   free -h

   # 查看系统负载
   uptime

   # 查看登录用户
   who
   w
   ```

3. **权限管理练习**
   ```bash
   # 创建测试文件
   touch test.txt
   ls -l test.txt

   # 修改权限
   chmod 644 test.txt
   ls -l test.txt

   chmod u+x test.txt
   ls -l test.txt

   # 符号方式修改
   chmod g+w test.txt
   chmod o-r test.txt
   ls -l test.txt
   ```

4. **包管理练习**
   ```bash
   # 更新包列表
   sudo apt update

   # 搜索软件
   apt search calculator

   # 显示包信息
   apt show bc

   # 列出已安装的包
   apt list --installed | grep vim
   ```

### 综合练习

1. **系统健康检查脚本**
   ```bash
   #!/bin/bash
   echo "=== System Health Check ==="
   echo "Disk Usage:"
   df -h
   echo -e "\nMemory Usage:"
   free -h
   echo -e "\nTop 5 CPU Processes:"
   ps aux --sort=-%cpu | head -6
   echo -e "\nTop 5 Memory Processes:"
   ps aux --sort=-%mem | head -6
   ```

2. **用户权限管理练习**
   ```bash
   # 创建测试用户和组（需要root权限）
   sudo groupadd testgroup
   sudo useradd -m -g testgroup testuser

   # 创建共享目录
   sudo mkdir /shared
   sudo chgrp testgroup /shared
   sudo chmod 770 /shared

   # 切换用户测试
   su - testuser
   touch /shared/test.txt
   exit
   ```

3. **日志监控练习**
   ```bash
   # 监控系统日志
   tail -f /var/log/syslog &
   jobs

   # 查看nginx日志（如果安装了nginx）
   sudo tail -f /var/log/nginx/access.log &
   ```

## 📚 学习要点

1. **进程状态理解**：
   - `R`：运行中
   - `S`：睡眠状态
   - `D`：不可中断睡眠
   - `Z`：僵尸进程
   - `T`：已停止

2. **权限数字计算**：
   - 所有者权限：r=4, w=2, x=1
   - 组权限：同上
   - 其他用户权限：同上
   - 总和即为权限数字

3. **sudo vs su**：
   - `sudo`：临时提升权限，执行完后回到普通用户
   - `su`：切换到其他用户，完全改变身份

4. **系统负载理解**：
   - 负载值表示等待CPU的进程数
   - 通常负载值不应超过CPU核心数的2倍

## 🎯 阶段检查清单

- [ ] 能熟练查看和管理进程
- [ ] 掌握系统资源监控命令
- [ ] 理解并能修改文件权限
- [ ] 掌握基本的包管理操作
- [ ] 了解用户和组管理概念
- [ ] 能使用sudo执行特权命令

## 🔄 下一步预览

完成本阶段后，你将进入**阶段4：网络与高级应用**，学习网络配置、文件传输和高级命令技巧，成为全能的Linux用户。

---

## 💡 学习提示

- **谨慎使用root权限**：只有在必要时才使用sudo
- **定期监控系统**：养成查看系统资源使用情况的习惯
- **理解权限模型**：Linux的三级权限模型是安全的基础
- **备份重要数据**：在进行系统操作前备份重要文件
